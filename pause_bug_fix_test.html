<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æš‚åœåŠŸèƒ½Bugä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a2a;
            font-family: Arial, sans-serif;
            color: #ffffff;
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #00ffff;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
        }
        
        .info {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
        }
        
        .canvas-container {
            text-align: center;
            margin: 20px 0;
        }
        
        canvas {
            border: 2px solid #00ffff;
            border-radius: 10px;
            background: linear-gradient(to right, rgba(0, 20, 40, 0.8), rgba(30, 15, 60, 0.8));
        }
        
        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #2ecc71;
        }
        
        .error-details {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æš‚åœåŠŸèƒ½Bugä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>âŒ é—®é¢˜æè¿°</h2>
        
        <div class="test-result error">
            <h3>TypeError: Failed to execute 'roundRect' on 'CanvasRenderingContext2D'</h3>
            <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong></p>
            <div class="error-details">
TypeError: Failed to execute 'roundRect' on 'CanvasRenderingContext2D': The provided value cannot be converted to a sequence.
    at GameInfo.renderPauseOverlay (gameinfo.js:688)
    at GameInfo.render (gameinfo.js:107)
    at Main.render (main.js:170)
    at Main.loop (main.js:203)
            </div>
            <p><strong>é—®é¢˜åŸå› ï¼š</strong></p>
            <ul>
                <li>åœ¨æŸäº›æµè§ˆå™¨ç¯å¢ƒä¸­ï¼ŒCanvasçš„roundRectæ–¹æ³•å‚æ•°æ ¼å¼ä¸å…¼å®¹</li>
                <li>roundRectæ–¹æ³•éœ€è¦ç‰¹å®šçš„å‚æ•°æ ¼å¼ï¼Œä½†å½“å‰ä»£ç ä½¿ç”¨äº†ä¸å…¼å®¹çš„æ ¼å¼</li>
                <li>éœ€è¦æä¾›å…¼å®¹çš„åœ†è§’çŸ©å½¢ç»˜åˆ¶æ–¹æ³•</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <h2>âœ… ä¿®å¤æ–¹æ¡ˆ</h2>
        
        <div class="test-result success">
            <h3>å…¼å®¹æ€§åœ†è§’çŸ©å½¢ç»˜åˆ¶æ–¹æ³•</h3>
            <p>âœ… å·²ä¿®å¤roundRectæ–¹æ³•å…¼å®¹æ€§é—®é¢˜</p>
            <ul>
                <li>æ·»åŠ äº†drawRoundedRectå…¼å®¹æ–¹æ³•</li>
                <li>ä¼˜å…ˆä½¿ç”¨åŸç”ŸroundRectæ–¹æ³•</li>
                <li>å¦‚æœåŸç”Ÿæ–¹æ³•ä¸å¯ç”¨ï¼Œä½¿ç”¨æ‰‹åŠ¨ç»˜åˆ¶çš„åœ†è§’çŸ©å½¢</li>
                <li>ç¡®ä¿åœ¨æ‰€æœ‰æµè§ˆå™¨ç¯å¢ƒä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>
        
        <div class="test-result info">
            <h3>ä¿®å¤ä»£ç </h3>
            <pre><code>/**
 * ç»˜åˆ¶åœ†è§’çŸ©å½¢çš„å…¼å®¹æ–¹æ³•
 */
drawRoundedRect(ctx, x, y, width, height, radius) {
  // å¦‚æœæµè§ˆå™¨æ”¯æŒroundRectï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•
  if (ctx.roundRect) {
    try {
      ctx.roundRect(x, y, width, height, radius);
      return;
    } catch (e) {
      // å¦‚æœroundRectå¤±è´¥ï¼Œä½¿ç”¨æ‰‹åŠ¨ç»˜åˆ¶
      console.log('âš ï¸ roundRectæ–¹æ³•ä¸å¯ç”¨ï¼Œä½¿ç”¨æ‰‹åŠ¨ç»˜åˆ¶åœ†è§’çŸ©å½¢');
    }
  }

  // æ‰‹åŠ¨ç»˜åˆ¶åœ†è§’çŸ©å½¢
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
}</code></pre>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        
        <div class="test-result info">
            <h3>Canvasåœ†è§’çŸ©å½¢ç»˜åˆ¶æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•åœ†è§’çŸ©å½¢ç»˜åˆ¶åŠŸèƒ½ï¼š</p>
            
            <div class="canvas-container">
                <canvas id="testCanvas" width="600" height="400"></canvas>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="testRoundedRect()">æµ‹è¯•åœ†è§’çŸ©å½¢ç»˜åˆ¶</button>
                <button onclick="testPauseOverlay()">æµ‹è¯•æš‚åœç•Œé¢ç»˜åˆ¶</button>
                <button onclick="clearCanvas()">æ¸…é™¤ç”»å¸ƒ</button>
            </div>
        </div>
        
        <div class="test-result info">
            <h3>æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>åœ†è§’çŸ©å½¢æµ‹è¯•ï¼š</strong>ç»˜åˆ¶ä¸åŒå¤§å°çš„åœ†è§’çŸ©å½¢</li>
                <li><strong>æš‚åœç•Œé¢æµ‹è¯•ï¼š</strong>æ¨¡æ‹Ÿæš‚åœç•Œé¢çš„ç»˜åˆ¶</li>
                <li><strong>å…¼å®¹æ€§æµ‹è¯•ï¼š</strong>éªŒè¯åœ¨ä¸åŒæµè§ˆå™¨ç¯å¢ƒä¸‹çš„å…¼å®¹æ€§</li>
                <li><strong>é”™è¯¯å¤„ç†ï¼š</strong>ç¡®ä¿å³ä½¿åŸç”Ÿæ–¹æ³•å¤±è´¥ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶</h2>
        
        <div class="test-result info">
            <h3>js/runtime/gameinfo.js</h3>
            <ul>
                <li>æ›¿æ¢äº†ctx.roundRect()è°ƒç”¨ä¸ºthis.drawRoundedRect()</li>
                <li>æ·»åŠ äº†drawRoundedRectå…¼å®¹æ–¹æ³•</li>
                <li>æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ</li>
                <li>ç¡®ä¿åœ¨æ‰€æœ‰æµè§ˆå™¨ç¯å¢ƒä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸGameInfoç±»çš„drawRoundedRectæ–¹æ³•
        function drawRoundedRect(ctx, x, y, width, height, radius) {
            // å¦‚æœæµè§ˆå™¨æ”¯æŒroundRectï¼Œä½¿ç”¨åŸç”Ÿæ–¹æ³•
            if (ctx.roundRect) {
                try {
                    ctx.roundRect(x, y, width, height, radius);
                    return;
                } catch (e) {
                    // å¦‚æœroundRectå¤±è´¥ï¼Œä½¿ç”¨æ‰‹åŠ¨ç»˜åˆ¶
                    console.log('âš ï¸ roundRectæ–¹æ³•ä¸å¯ç”¨ï¼Œä½¿ç”¨æ‰‹åŠ¨ç»˜åˆ¶åœ†è§’çŸ©å½¢');
                }
            }

            // æ‰‹åŠ¨ç»˜åˆ¶åœ†è§’çŸ©å½¢
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        function testRoundedRect() {
            console.log('ğŸ¨ æµ‹è¯•åœ†è§’çŸ©å½¢ç»˜åˆ¶');
            
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, 'rgba(0, 20, 40, 0.8)');
            gradient.addColorStop(1, 'rgba(30, 15, 60, 0.8)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å¤šä¸ªåœ†è§’çŸ©å½¢
            const rectangles = [
                { x: 50, y: 50, width: 100, height: 60, radius: 10, color: '#ff6b6b' },
                { x: 200, y: 50, width: 120, height: 80, radius: 15, color: '#4ecdc4' },
                { x: 350, y: 50, width: 150, height: 100, radius: 20, color: '#45b7d1' },
                { x: 50, y: 150, width: 200, height: 120, radius: 25, color: '#96ceb4' },
                { x: 280, y: 150, width: 180, height: 90, radius: 12, color: '#f39c12' }
            ];
            
            rectangles.forEach((rect, index) => {
                ctx.fillStyle = rect.color;
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                drawRoundedRect(ctx, rect.x, rect.y, rect.width, rect.height, rect.radius);
                ctx.fill();
                ctx.stroke();
                
                // æ·»åŠ æ ‡ç­¾
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`çŸ©å½¢${index + 1}`, rect.x + rect.width/2, rect.y + rect.height/2 + 5);
            });
            
            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result success';
            resultDiv.innerHTML = `
                <h4>âœ… åœ†è§’çŸ©å½¢ç»˜åˆ¶æµ‹è¯•æˆåŠŸ</h4>
                <p>æˆåŠŸç»˜åˆ¶äº†${rectangles.length}ä¸ªä¸åŒå¤§å°çš„åœ†è§’çŸ©å½¢</p>
                <p>å…¼å®¹æ€§æ–¹æ³•æ­£å¸¸å·¥ä½œ</p>
            `;
            
            document.querySelector('.test-section:nth-child(3)').appendChild(resultDiv);
            
            // 3ç§’åç§»é™¤æµ‹è¯•ç»“æœ
            setTimeout(() => {
                resultDiv.remove();
            }, 3000);
        }

        function testPauseOverlay() {
            console.log('â¸ï¸ æµ‹è¯•æš‚åœç•Œé¢ç»˜åˆ¶');
            
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, 'rgba(0, 20, 40, 0.8)');
            gradient.addColorStop(1, 'rgba(30, 15, 60, 0.8)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶æš‚åœç•Œé¢
            // åŠé€æ˜èƒŒæ™¯
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æš‚åœæç¤ºæ¡†
            const boxWidth = 300;
            const boxHeight = 200;
            const boxX = (canvas.width - boxWidth) / 2;
            const boxY = (canvas.height - boxHeight) / 2;

            // ç»˜åˆ¶æç¤ºæ¡†èƒŒæ™¯
            ctx.fillStyle = 'rgba(0, 20, 40, 0.95)';
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            drawRoundedRect(ctx, boxX, boxY, boxWidth, boxHeight, 10);
            ctx.fill();
            ctx.stroke();

            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#00ffff';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('æ¸¸æˆå·²æš‚åœ', canvas.width / 2, boxY + 50);

            // ç»˜åˆ¶æç¤ºæ–‡å­—
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px Arial';
            ctx.fillText('ç‚¹å‡»ä»»æ„ä½ç½®ç»§ç»­æ¸¸æˆ', canvas.width / 2, boxY + 100);

            // ç»˜åˆ¶å…³é—­æŒ‰é’®
            const closeButtonWidth = 120;
            const closeButtonHeight = 40;
            const closeButtonX = (canvas.width - closeButtonWidth) / 2;
            const closeButtonY = boxY + 130;

            // æŒ‰é’®èƒŒæ™¯
            ctx.fillStyle = '#27ae60';
            ctx.beginPath();
            drawRoundedRect(ctx, closeButtonX, closeButtonY, closeButtonWidth, closeButtonHeight, 5);
            ctx.fill();

            // æŒ‰é’®æ–‡å­—
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('ç»§ç»­æ¸¸æˆ', canvas.width / 2, closeButtonY + 25);
            
            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result success';
            resultDiv.innerHTML = `
                <h4>âœ… æš‚åœç•Œé¢ç»˜åˆ¶æµ‹è¯•æˆåŠŸ</h4>
                <p>æˆåŠŸç»˜åˆ¶äº†æš‚åœç•Œé¢</p>
                <p>åœ†è§’çŸ©å½¢ç»˜åˆ¶æ­£å¸¸ï¼Œæ— å…¼å®¹æ€§é—®é¢˜</p>
            `;
            
            document.querySelector('.test-section:nth-child(3)').appendChild(resultDiv);
            
            // 3ç§’åç§»é™¤æµ‹è¯•ç»“æœ
            setTimeout(() => {
                resultDiv.remove();
            }, 3000);
        }

        function clearCanvas() {
            console.log('ğŸ§¹ æ¸…é™¤ç”»å¸ƒ');
            
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, 'rgba(0, 20, 40, 0.8)');
            gradient.addColorStop(1, 'rgba(30, 15, 60, 0.8)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('ğŸ”§ æš‚åœåŠŸèƒ½Bugä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('âœ… roundRectå…¼å®¹æ€§é—®é¢˜å·²ä¿®å¤');
            
            // åˆå§‹åŒ–ç”»å¸ƒ
            clearCanvas();
        });
    </script>
</body>
</html> 