<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­å¼¹å¯è§æ€§å’ŒçŸ¥è¯†åº“åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a2a;
            font-family: Arial, sans-serif;
            color: #ffffff;
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #00ffff;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
        }
        
        .info {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
        }
        
        .warning {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
        }
        
        .mock-game {
            position: relative;
            width: 600px;
            height: 400px;
            background: linear-gradient(to right, rgba(0, 20, 40, 0.8), rgba(30, 15, 60, 0.8));
            border: 2px solid #00ffff;
            border-radius: 10px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .mock-commander {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(to bottom, #3498db, #2980b9);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .mock-threat {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff6b6b, #ff8c00);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            animation: fall 8s linear infinite;
        }
        
        .mock-bullet {
            position: absolute;
            width: 16px;
            height: 30px;
            background: linear-gradient(to bottom, #00ffff, #0080ff);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            display: none;
        }
        
        .mock-knowledge-button {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 120px;
            height: 40px;
            background: linear-gradient(to bottom, #ffd700, #ffa500);
            border: 2px solid #ffd700;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }
        
        .mock-knowledge-button:hover {
            background: linear-gradient(to bottom, #ffa500, #ffd700);
            transform: scale(1.05);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #2ecc71;
        }
        
        .status-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .knowledge-records {
            position: absolute;
            top: 120px;
            right: 20px;
            width: 300px;
            max-height: 200px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #ffd700;
            border-radius: 5px;
            padding: 10px;
            font-size: 10px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å­å¼¹å¯è§æ€§å’ŒçŸ¥è¯†åº“åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>âœ… ä¿®å¤è¯´æ˜</h2>
        
        <div class="test-result success">
            <h3>é—®é¢˜ä¿®å¤</h3>
            <p>âœ… å·²ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š</p>
            <ul>
                <li><strong>å­å¼¹å¯è§æ€§ï¼š</strong>ä¿®å¤äº†å­å¼¹visibleå±æ€§è®¾ç½®é—®é¢˜</li>
                <li><strong>çŸ¥è¯†åº“æŒ‰é’®ï¼š</strong>æ·»åŠ äº†çŸ¥è¯†åº“æŒ‰é’®çš„è§¦æ‘¸å¤„ç†åŠŸèƒ½</li>
                <li><strong>ç¢°æ’æ£€æµ‹ï¼š</strong>ç¡®ä¿å­å¼¹èƒ½æ­£ç¡®å‚ä¸ç¢°æ’æ£€æµ‹</li>
                <li><strong>çŸ¥è¯†è®°å½•ï¼š</strong>å®ç°äº†çŸ¥è¯†åº“è®°å½•çš„æ˜¾ç¤ºåŠŸèƒ½</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        
        <div class="test-result info">
            <h3>æ¨¡æ‹Ÿæ¸¸æˆåœºæ™¯</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•å­å¼¹å¯è§æ€§å’ŒçŸ¥è¯†åº“åŠŸèƒ½ï¼š</p>
            
            <div class="mock-game" id="mockGame">
                <div class="status-display" id="statusDisplay">
                    <div>å­å¼¹çŠ¶æ€: <span id="bulletStatus">æœªå‘å°„</span></div>
                    <div>å­å¼¹å¯è§: <span id="bulletVisible">false</span></div>
                    <div>çŸ¥è¯†è®°å½•: <span id="knowledgeCount">0</span></div>
                </div>
                
                <div class="mock-threat" id="mockThreat" style="left: 280px;">å¨èƒ</div>
                <div class="mock-bullet" id="mockBullet" style="left: 292px; bottom: 60px;"></div>
                <div class="mock-commander">æŒ‡æŒ¥å®˜</div>
                
                <div class="mock-knowledge-button" onclick="showKnowledgeBase()">ğŸ“š çŸ¥è¯†åº“</div>
                <div class="knowledge-records" id="knowledgeRecords">
                    <h4>çŸ¥è¯†åº“è®°å½•</h4>
                    <div id="recordsList"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="testBulletVisibility()">æµ‹è¯•å­å¼¹å¯è§æ€§</button>
                <button onclick="testBulletCollision()">æµ‹è¯•å­å¼¹ç¢°æ’</button>
                <button onclick="testKnowledgeRecords()">æµ‹è¯•çŸ¥è¯†è®°å½•</button>
                <button onclick="resetTest()">é‡ç½®æµ‹è¯•</button>
            </div>
        </div>
        
        <div class="test-result info">
            <h3>ä¿®å¤è¯¦æƒ…</h3>
            <div style="font-family: monospace; font-size: 12px; background: rgba(0, 0, 0, 0.9); padding: 15px; border-radius: 5px;">
                <strong>1. å­å¼¹å¯è§æ€§ä¿®å¤ï¼š</strong><br>
                - åœ¨å­å¼¹åˆå§‹åŒ–æ—¶è®¾ç½® this.visible = true<br>
                - åœ¨renderæ–¹æ³•ä¸­æ£€æŸ¥ visible å±æ€§<br>
                - ç¡®ä¿å­å¼¹èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œå‚ä¸ç¢°æ’æ£€æµ‹<br><br>
                
                <strong>2. çŸ¥è¯†åº“æŒ‰é’®åŠŸèƒ½ï¼š</strong><br>
                - æ·»åŠ äº†çŸ¥è¯†åº“æŒ‰é’®çš„è§¦æ‘¸å¤„ç†<br>
                - å®ç°äº† showKnowledgeBase() æ–¹æ³•<br>
                - æ˜¾ç¤ºçŸ¥è¯†åº“è®°å½•å’Œè¯¦ç»†ä¿¡æ¯<br><br>
                
                <strong>3. ç¢°æ’æ£€æµ‹ä¼˜åŒ–ï¼š</strong><br>
                - ç¡®ä¿å­å¼¹çš„ visible å’Œ isActive å±æ€§æ­£ç¡®<br>
                - ä¿®å¤äº†ç¢°æ’æ£€æµ‹å¤±è´¥çš„é—®é¢˜<br>
                - æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯<br><br>
                
                <strong>4. çŸ¥è¯†è®°å½•ç³»ç»Ÿï¼š</strong><br>
                - å®ç°äº†çŸ¥è¯†åº“è®°å½•çš„æ˜¾ç¤º<br>
                - æ”¯æŒé”™è¯¯è®°å½•å’ŒæˆåŠŸè®°å½•<br>
                - æä¾›è¯¦ç»†çš„æ—¶é—´æˆ³å’Œç±»å‹ä¿¡æ¯
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ ä»£ç ä¿®æ”¹è¯¦æƒ…</h2>
        
        <div class="test-result info">
            <h3>1. js/player/bullet.js ä¿®æ”¹</h3>
            <pre><code>// ä¿®å¤å­å¼¹å¯è§æ€§
init(x, y, type = 'normal') {
  this.x = x;
  this.y = y;
  this.type = type;
  this.isActive = true;
  this.visible = true; // ç¡®ä¿å­å¼¹å¯è§
  this.trail = [];
  
  this.setupBulletType();
  console.log(`ğŸ’¥ å­å¼¹åˆå§‹åŒ–: ä½ç½®(${x}, ${y}), ç±»å‹: ${type}, å¯è§: ${this.visible}`);
}

// ä¿®å¤æ¸²æŸ“æ–¹æ³•
render(ctx) {
  if (!this.isActive || !this.visible) return; // æ£€æŸ¥å¯è§æ€§
  // ... æ¸²æŸ“é€»è¾‘
}</code></pre>
        </div>
        
        <div class="test-result info">
            <h3>2. js/runtime/gameinfo.js ä¿®æ”¹</h3>
            <pre><code>// æ·»åŠ çŸ¥è¯†åº“æŒ‰é’®è§¦æ‘¸å¤„ç†
handleTouch(x, y) {
  // æ£€æŸ¥çŸ¥è¯†åº“æŒ‰é’®
  if (this.showKnowledgeButton) {
    const knowledgeButtonWidth = 120;
    const knowledgeButtonHeight = 40;
    const knowledgeButtonX = SCREEN_WIDTH - knowledgeButtonWidth - 20;
    const knowledgeButtonY = 70;

    if (x >= knowledgeButtonX && x <= knowledgeButtonX + knowledgeButtonWidth &&
        y >= knowledgeButtonY && y <= knowledgeButtonY + knowledgeButtonHeight) {
      console.log('ğŸ“š ç‚¹å‡»äº†çŸ¥è¯†åº“æŒ‰é’®');
      this.showKnowledgeBase();
      return;
    }
  }
  // ... å…¶ä»–è§¦æ‘¸å¤„ç†
}

// æ·»åŠ çŸ¥è¯†åº“æ˜¾ç¤ºæ–¹æ³•
showKnowledgeBase() {
  console.log('ğŸ“š æ˜¾ç¤ºçŸ¥è¯†åº“');
  
  if (GameGlobal.databus && GameGlobal.databus.knowledgeRecords) {
    const records = GameGlobal.databus.knowledgeRecords;
    console.log(`ğŸ“– çŸ¥è¯†åº“è®°å½•æ•°é‡: ${records.length}`);
    
    records.forEach((record, index) => {
      console.log(`ğŸ“ è®°å½• ${index + 1}:`);
      console.log(`   æ—¶é—´: ${record.timestamp}`);
      console.log(`   ç±»å‹: ${record.type}`);
      console.log(`   å†…å®¹: ${record.point}`);
    });
  }
  
  this.emit('showKnowledgeBase');
}</code></pre>
        </div>
    </div>

    <script>
        let bulletVisible = false;
        let knowledgeRecords = [];
        let isShooting = false;
        
        function testBulletVisibility() {
            console.log('ğŸ” æµ‹è¯•å­å¼¹å¯è§æ€§');
            
            const bullet = document.getElementById('mockBullet');
            bullet.style.display = 'block';
            bulletVisible = true;
            
            document.getElementById('bulletStatus').textContent = 'å·²å‘å°„';
            document.getElementById('bulletVisible').textContent = 'true';
            
            // æ¨¡æ‹Ÿå­å¼¹ç§»åŠ¨
            let bulletY = 60;
            const animation = setInterval(() => {
                bulletY += 5;
                bullet.style.bottom = bulletY + 'px';
                
                if (bulletY >= 200) {
                    clearInterval(animation);
                    bullet.style.display = 'none';
                    bullet.style.bottom = '60px';
                    bulletVisible = false;
                    
                    document.getElementById('bulletStatus').textContent = 'å·²é”€æ¯';
                    document.getElementById('bulletVisible').textContent = 'false';
                    
                    console.log('ğŸ’¥ å­å¼¹ç¢°æ’æµ‹è¯•å®Œæˆ');
                }
            }, 50);
            
            showResult('success', 'å­å¼¹å¯è§æ€§æµ‹è¯•å®Œæˆ');
        }
        
        function testBulletCollision() {
            console.log('ğŸ’¥ æµ‹è¯•å­å¼¹ç¢°æ’æ£€æµ‹');
            
            // æ¨¡æ‹Ÿç¢°æ’æ£€æµ‹
            const bulletX = 292;
            const bulletY = 200;
            const threatX = 280;
            const threatY = 200;
            
            const distance = Math.sqrt(
                Math.pow(bulletX - threatX, 2) + 
                Math.pow(bulletY - threatY, 2)
            );
            
            console.log(`ğŸ“ å­å¼¹ä½ç½®: (${bulletX}, ${bulletY})`);
            console.log(`ğŸ“ å¨èƒä½ç½®: (${threatX}, ${threatY})`);
            console.log(`ğŸ“ è·ç¦»: ${distance.toFixed(2)}`);
            
            if (distance < 50) {
                console.log('âœ… ç¢°æ’æ£€æµ‹æˆåŠŸï¼');
                showResult('success', 'ç¢°æ’æ£€æµ‹æˆåŠŸï¼Œè·ç¦»: ' + distance.toFixed(2));
            } else {
                console.log('âŒ ç¢°æ’æ£€æµ‹å¤±è´¥ï¼Œè·ç¦»è¿‡è¿œ');
                showResult('warning', 'ç¢°æ’æ£€æµ‹å¤±è´¥ï¼Œè·ç¦»: ' + distance.toFixed(2));
            }
        }
        
        function testKnowledgeRecords() {
            console.log('ğŸ“š æµ‹è¯•çŸ¥è¯†è®°å½•');
            
            // æ·»åŠ ä¸€äº›æµ‹è¯•è®°å½•
            const testRecords = [
                {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString(),
                    type: 'success',
                    point: 'æˆåŠŸä½¿ç”¨é˜²ç«å¢™é˜²å¾¡é’“é±¼æ”»å‡»'
                },
                {
                    id: Date.now() + 1,
                    timestamp: new Date().toLocaleString(),
                    type: 'error',
                    point: 'é”™è¯¯ä½¿ç”¨åŠ å¯†å¸ˆé˜²å¾¡æ¶æ„è½¯ä»¶',
                    threatName: 'æ¶æ„è½¯ä»¶',
                    wrongDefense: 'åŠ å¯†å¸ˆ',
                    correctDefense: 'æ£€æµ‹è€…'
                }
            ];
            
            knowledgeRecords = testRecords;
            document.getElementById('knowledgeCount').textContent = knowledgeRecords.length;
            
            console.log(`ğŸ“– æ·»åŠ äº† ${knowledgeRecords.length} æ¡çŸ¥è¯†è®°å½•`);
            showResult('success', `æ·»åŠ äº† ${knowledgeRecords.length} æ¡çŸ¥è¯†è®°å½•`);
        }
        
        function showKnowledgeBase() {
            console.log('ğŸ“š æ˜¾ç¤ºçŸ¥è¯†åº“');
            
            const recordsDiv = document.getElementById('knowledgeRecords');
            const recordsList = document.getElementById('recordsList');
            
            if (knowledgeRecords.length === 0) {
                recordsList.innerHTML = '<p>æš‚æ— çŸ¥è¯†è®°å½•</p>';
            } else {
                let html = '';
                knowledgeRecords.forEach((record, index) => {
                    html += `<div style="margin-bottom: 10px; padding: 5px; border-left: 3px solid ${record.type === 'success' ? '#00ff00' : '#ff0000'};">`;
                    html += `<strong>è®°å½• ${index + 1}</strong><br>`;
                    html += `æ—¶é—´: ${record.timestamp}<br>`;
                    html += `ç±»å‹: ${record.type === 'success' ? 'æˆåŠŸ' : 'é”™è¯¯'}<br>`;
                    html += `å†…å®¹: ${record.point}<br>`;
                    
                    if (record.type === 'error') {
                        html += `å¨èƒ: ${record.threatName}<br>`;
                        html += `é”™è¯¯é˜²å¾¡: ${record.wrongDefense}<br>`;
                        html += `æ­£ç¡®é˜²å¾¡: ${record.correctDefense}<br>`;
                    }
                    html += '</div>';
                });
                recordsList.innerHTML = html;
            }
            
            recordsDiv.style.display = recordsDiv.style.display === 'none' ? 'block' : 'none';
        }
        
        function resetTest() {
            bulletVisible = false;
            knowledgeRecords = [];
            isShooting = false;
            
            // é‡ç½®æ˜¾ç¤º
            document.getElementById('bulletStatus').textContent = 'æœªå‘å°„';
            document.getElementById('bulletVisible').textContent = 'false';
            document.getElementById('knowledgeCount').textContent = '0';
            document.getElementById('knowledgeRecords').style.display = 'none';
            
            // é‡ç½®å­å¼¹
            const bullet = document.getElementById('mockBullet');
            bullet.style.display = 'none';
            bullet.style.bottom = '60px';
            
            showResult('info', 'æµ‹è¯•å·²é‡ç½®');
        }
        
        function showResult(type, message) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<h4>${message}</h4>`;
            
            document.querySelector('.test-section:nth-child(2)').appendChild(resultDiv);
            
            setTimeout(() => {
                resultDiv.remove();
            }, 3000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('ğŸ” å­å¼¹å¯è§æ€§å’ŒçŸ¥è¯†åº“åŠŸèƒ½æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('âœ… å­å¼¹å¯è§æ€§å’ŒçŸ¥è¯†åº“åŠŸèƒ½å·²ä¿®å¤');
        });
    </script>
</body>
</html> 